<!DOCTYPE html>
<html lang="en" ng-app="pdmApp">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Patient Data Manager</title>
        <link href="images/favicon.ico" rel="icon" type="image/x-icon" />

		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

		<![endif]-->
        <style type="text/css">
            .editor-label {
                float: left;
                width: 200px;
            }

            .editor-field {
                margin-left:200px;
            }

            .editor-field input {
                width: 100%;
            }
        </style>

        <script>
             function openCreateDialog(el) {
                 var $scope = angular.element(el).scope();
                 $scope.openCreateDialog('create');
             }
        </script>

    </head>
	<body ng-controller="pdmCtrl">
    <div webix-ui type="space"> <!--layout rows with type "space" are created-->
            <div height="65" class="navbar navbar-inverse">
                <p class="navbar-brand"><span class="glyphicon glyphicon-user"></span>{{patient.name}}</p>
                <p class="navbar-text">sex <span class="title">{{patient.sex}}</span></p>
                <p class="navbar-text">dob <span class="title">{{patient.dob | date: 'dd MMM yyyy HH:mm'}}</span></p>
                <p class="navbar-text">age <span class="title">{{patient.dob | age}}</span></p>
            </div>

    <div id="mainCols" view="cols" resizeColumn=true type="wide" margin="10"> <!--Webix layout cols are initialized-->

        <div view="list" id="resList" webix-data="resourceList" webix-event="onSelectChange = selectedResourceList()"
             template="#resource# (#count#) <a href='#' class='float-right-btn'
                     onclick='openCreateDialog(this)'><i class='fa fa-plus-square-o fa-lg'></i></a>" autowidth=true select=1 width="200"></div>

                <div view="resizer"></div>
                <div view="rows" type="wide">
                    <div height=45>
                        <div class="editor-label"><label>Observations Filter: </label></div>
                        <div class="editor-field"><input type="text" class="input-box form-control" ng-model="enteredFilter"/></div>
                    </div>
                    <div view="datatable" id="obsList" webix-data="observationList" select="row"
                         resizeColumn=true webix-event="onSelectChange = selectedObservationList()" navigation=true>
                        <div view="column" header="Observation" map="#code.coding[0].display#" width=300 sort="string"></div>
                        <div view="column" header="Effective Date" map="#prettyDate#" width=200 sort="date"></div>
                        <div view="column" header="Code" map="#code.coding[0].code#" width=100 sort="string"></div>
                        <div view="column" header="System" map="#code.coding[0].system#" width=200></div>
                        <div view="column" header="Value" map="#valueQuantity.value#" width=100 sort="int"></div>
                        <div view="column" header="Units" map="#valueQuantity.unit#" width=100></div>
                        <div view="column" header="Status" map="#status#" width=100 sort="string"></div>
                    </div>
                    <div id="paging_here" ng-init="selection = { selectedPage:  null }" height=32>
                        <div class="webix_pager_item" ng-class="{webix_pager_item_selected: selection.selectedPage == page}"
                             ng-click="selection.selectedPage = page; pageSelected(page)" ng-repeat="page in pages">{{page.pageNum}}</div>
                    </div>
                </div>
            </div>
            <div view="resizer"></div>
        <div view="tabview" id="detailView" height="270" tabMinWidth=200>
            <div header="Details" tabwidth=100>
                <div class="form-group" >
                    <!--<div class="editor-label"><label>Observation:</label></div>-->
                    <!--<div class="editor-field"><input type="text" class="input-box form-control" ng-model="selectedObservation.code.coding[0].display"/></div>-->

                    <table>
                        <tr><td>Observation:</td><td>
                            <div class='typeahead'>
                                <input type="text" class="form-control" ng-model="selectedObservation.code.coding[0].display" placeholder="Enter the Display Value"
                                    uib-typeahead="coding.display for coding in getValueSetExpansion($viewValue)" typeahead-loading="loadingValueSetDisplay"
                                    typeahead-no-results="noResultsDisplay" typeahead-editable="false" typeahead-on-select="setCoding($item, $model, $label)">
                                <i ng-show="loadingValueSetDisplay" class="glyphicon glyphicon-refresh"></i>
                                <div ng-show="noResultsDisplay">
                                    <i class="glyphicon glyphicon-remove"></i> No results  <!--{{resultsStatus}}-->
                                </div>
                            </div>
                            </td>
                            <td>Effective Date:</td><td><input type="text" class="form-control" ng-model="selectedObservation.prettyDate"></td></tr>

                        <tr><td>Code:</td><td>
                            <div class='typeahead'>
                                <input type="text" class="form-control" ng-model="selectedObservation.code.coding[0].code" placeholder="Enter the Code Value"
                                       uib-typeahead="coding.code for coding in getValueSetExpansion($viewValue)" typeahead-loading="loadingValueSet"
                                       typeahead-no-results="noResults" typeahead-editable="false" typeahead-on-select="setCoding($item, $model, $label)">
                                <i ng-show="loadingValueSet" class="glyphicon glyphicon-refresh"></i>
                                <div ng-show="noResults">
                                    <i class="glyphicon glyphicon-remove"></i> No results  <!--{{resultsStatus}}-->
                                </div>
                            </div>
                        </td>
                            <td>System:</td><td><input type="text" class="form-control" ng-model="selectedObservation.code.coding[0].system"></td></tr>

                        <tr><td>Value:</td><td><input type="text" class="form-control" ng-model="selectedObservation.valueQuantity.value"></td>
                            <td>Units:</td><td><input type="text" class="form-control" ng-model="selectedObservation.valueQuantity.unit"></td></tr>

                        <tr><td>Status:</td><td><input type="text" class="form-control" ng-model="selectedObservation.status"></td></tr>
                        <tr><td colspan="2"><table>
                            <tr>
                                <td><button class="webixbutton form-btn" ng-click="updateResource()">Update</button></td>
                                <td><button class="webixbutton form-btn" ng-click="openCreateDialog('clone')">Clone</button></td>
                                <td><button class="webixbutton form-btn" ng-click="requestDeleteResource()">Delete</button></td>
                        </table></td></tr>
                    </table>
                </div>
            </div>
            <div header="Revision History">
                Revision History
            </div>
            <div header="Profiles">
                Profiles Here
            </div>
        </div>

        </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-animate.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.14.3.js"></script>
    <script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
    <script src="fhir-client/fhir-client.js"></script>
    <script src="js/app.js"></script>
    <script src="js/services.js"></script>
    <script src="js/controllers.js"></script>
    <script src="js/filters.js"></script>
    </body>
</html>
